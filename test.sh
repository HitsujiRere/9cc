#!/bin/bash

cc -o 9cclib.o 9cclib.c -c

assert() {
  expected="$1"
  input="$2"

  ./9cc "$input" > tmp.s
  cc -o tmp tmp.s 9cclib.o
  ./tmp
  actual="$?"

  if [ "$actual" = "$expected" ]; then
    echo "$input => $actual"
  else
    echo "$input => $expected expected, but got $actual"
    exit 1
  fi
}

assert 7 "int main() { int a; a = 10; a = a - 3; return a; }"
assert 30 "int ret30() { return 30; } int main() { return ret30(); }"
assert 18 "int calc(int a, int b) { return a*2+b; } int main() { return calc(7, 4); }"

# exit

assert 13 "int main(){13;}"
assert 5 "int main(){3+2;}"
assert 2 "int main(){9-7;}"
assert 11 "int main(){13+8-10;}"
assert 41 "int main(){ 12 + 34 - 5;}"
assert 7 "int main(){6+(10-9);}"
assert 47 "int main(){5+6*7;}"
assert 15 "int main(){5*(9-6);}"
assert 4 "int main(){(3+5)/2;}"
assert 17 "int main(){-10+27;}"
assert 21 "int main(){-3*-7;}"
assert 1 "int main(){12 == 12;}"
assert 1 "int main(){8 != 9;}"
assert 1 "int main(){6 <= 9;}"
assert 1 "int main(){9 >= 9;}"
assert 0 "int main(){13 <= 7;}"
assert 1 "int main(){6 < 9;}"
assert 0 "int main(){9 > 9;}"
assert 0 "int main(){7 > 13;}"
assert 1 "int main(){4 + 9 == 7 + 6;}"
assert 17 "int main(){8;12;17;}"
assert 4 "int main(){int a;a=4;}"
assert 21 "int main(){int foo;int bar;int foobar;foo=14;bar=foo/2;foobar=bar+foo;}"
assert 10 "int main(){return 10;}"
assert 10 "int main(){return 10;return 20;}"
assert 56 "int main(){int returnx;int returnreturn;returnx=7;returnreturn=returnx*8;return returnreturn;}"
assert 5 "int main(){if(3==3)return 5;return 7;}"
assert 7 "int main(){if(2>3)return 5;return 7;}"
assert 5 "int main(){if(4<=6)return 5;else return 7;}"
assert 7 "int main(){if(5<5)return 5;else return 7;}"
assert 10 "int main(){if(1)return 10;if(1)return 11;return 12;}"
assert 10 "int main(){if(1)return 10;if(0)return 11;return 12;}"
assert 11 "int main(){if(0)return 10;if(1)return 11;return 12;}"
assert 12 "int main(){if(0)return 10;if(0)return 11;return 12;}"
assert 10 "int main(){if(1)return 10;else if(1)return 11;return 12;}"
assert 10 "int main(){if(1)return 10;else if(0)return 11;return 12;}"
assert 11 "int main(){if(0)return 10;else if(1)return 11;return 12;}"
assert 12 "int main(){if(0)return 10;else if(0)return 11;return 12;}"
assert 10 "int main(){if(1)return 10;if(1)return 11;else return 12;}"
assert 10 "int main(){if(1)return 10;if(0)return 11;else return 12;}"
assert 11 "int main(){if(0)return 10;if(1)return 11;else return 12;}"
assert 12 "int main(){if(0)return 10;if(0)return 11;else return 12;}"
assert 10 "int main(){if(1)return 10;else if(1)return 11;else return 12;}"
assert 10 "int main(){if(1)return 10;else if(0)return 11;else return 12;}"
assert 11 "int main(){if(0)return 10;else if(1)return 11;else return 12;}"
assert 12 "int main(){if(0)return 10;else if(0)return 11;else return 12;}"
assert 10 "int main(){while(1)return 10;return 11;}"
assert 11 "int main(){while(0)return 10;return 11;}"
assert 8 "int main(){int a;a=0;while(a < 7)a=a+2;return a;}"
assert 11 "int main(){while(0)if(1)return 10;return 11;}"
assert 11 "int main(){while(0)if(0)return 10;return 11;}"
assert 10 "int main(){while(1)if(1)return 10;else return 11;return 12;}"
assert 11 "int main(){while(1)if(0)return 10;else return 11;return 12;}"
assert 12 "int main(){while(0)if(1)return 10;else return 11;return 12;}"
assert 12 "int main(){while(0)if(0)return 10;else return 11;return 12;}"
assert 12 "int main(){int a;a=3;while(a>=3)if(a<10)a=a+3;else return a;return 3;}"
assert 1 "int main(){int a;a=1;for(a=1;a<=3;a=a+1)return a;}"
assert 1 "int main(){int a;a=1;for(;a<=3;)return a;}"
assert 55 "int main(){int a;int b;b=0;for(a=1;a<=10;a=a+1)b=a+b;return b;}"
assert 30 "int main(){int a;int b;b=0;for(a=0;a<20;a=a+1)if(a<10)b=b+1;else b=b+2;return b;}"
assert 36 "int main(){int a;int x;int y;a=0;for(x=1;x<=3;x=x+1)for(y=1;y<=3;y=y+1)a=a+x+y;return a;}"
assert 24 "int main(){int a;int x;int y;a=0;for(x=1;x<=3;x=x+1)for(y=x;y<=3;y=y+1)a=a+x+y;return a;}"
assert 10 "int main(){{10;}}"
assert 10 "int main(){{return 10; return 20;}}"
assert 10 "int main(){int a;{}a=10;{}return a;}"
assert 10 "int main(){{int a;a=10;}return a;}"
assert 233 "int main(){int i;int f1;f1=1;int f2;f2=1;for(i=0;i<11;i=i+1){int tmp;tmp=f1;f1=f1+f2;f2=tmp;}return f1;}"
assert 1 "int main(){hello();return 1;}"
assert 33 "int main(){return ret33();}"
assert 14 "int main(){return multi2(3+4);}"
assert 21 "int main(){return sum(1,2,3,4,5,6);}"
assert 7 "int main(){print2num(7, 23);return 7;}"
assert 13 "int foo(){return 7;} int main(){return 13;}"
assert 7 "int foo(){return 7;} int main(){return foo();}"
assert 7 "int foo(int n){return n;} int main(){return foo(7);}"
assert 7 "int aiueo(int n){if(n>=10)return 3;return n;} int main(){return aiueo(7);}"
assert 3 "int aiueo(int n){if(n>=10)return 3;return n;} int main(){return aiueo(10);}"
assert 18 "int foo(int n, int m){return 2*n+m;} int main(){return foo(7, 4);}"
assert 35 "int foo(int n){return 2*n;} int bar(int n, int m){return foo(2*n+m)-1;} int main(){return bar(7, 4);}"
assert 29 "int foo(int n){return 2*n;} int bar(int n, int m){return foo(2*n+m)-n;} int main(){return bar(7, 4);}"
assert 0 "int ari(int n){if(n==0)return 0;return ari(n-1)+n;} int main(){return ari(0);}"
assert 1 "int ari(int n){if(n==0)return 0;return ari(n-1)+n;} int main(){return ari(1);}"
assert 3 "int ari(int n){if(n==0)return 0;return ari(n-1)+n;} int main(){return ari(2);}"
assert 55 "int ari(int n){if(n==0)return 0;return ari(n-1)+n;} int main(){return ari(10);}"
assert 3 "int main() { int x; int y; x = 3; y = &x; return *y; }"
assert 3 "int main() { int x; int y; int z; x = 3; y = 5; z = &y + 8; return *z; }"

echo OK
